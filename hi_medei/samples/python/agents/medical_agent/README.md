# Patient Data Manager Agent with A2A Protocol

λ³‘μ› λ‚΄ ν™μ λ°μ΄ν„° κ²€μƒ‰ λ° μ§„λ£λ¬Έμ„ μ‘μ„±μ„ μ„ν• μλ£ AI μ—μ΄μ „νΈμ…λ‹λ‹¤.
**A2A(Agent-to-Agent) ν”„λ΅ν† μ½κ³Ό MCP(Model Context Protocol) μ—°λ™μ„ μ§€μ›ν•©λ‹λ‹¤.**

## μ£Όμ” κΈ°λ¥

### π” ν™μ κ²€μƒ‰ μ‹μ¤ν…

- **ν™μ ID/μ΄λ¦„ κ²€μƒ‰**: κΈ°λ³Έ ν™μ μ •λ³΄ μ΅°ν
- **μ¦μƒ κΈ°λ° κ²€μƒ‰**: λ²΅ν„° κ²€μƒ‰μ„ ν™μ©ν• μ μ‚¬ μ¦μƒ ν™μ κ²€μƒ‰
- **μ§„λ£κ³Όλ³„ κ²€μƒ‰**: λ‚΄κ³Ό/μ™Έκ³Ό/λ‹ΉμΌμ§„λ£ λ¶„λ¥λ³„ ν™μ κ²€μƒ‰
- **μ²λ°© μ΄λ ¥ κ²€μƒ‰**: νΉμ • μ•½λ¬Ό μ²λ°© μ΄λ ¥μ΄ μλ” ν™μ κ²€μƒ‰

### π“ μ§„λ£λ¬Έμ„ μ‘μ„±

- **SOAP λ…ΈνΈ μƒμ„±**: κµ¬μ΅°ν™”λ μ§„λ£ κΈ°λ΅ μλ™ μƒμ„±
- **μ²λ°©μ „ μ‘μ„±**: AI κΈ°λ° μ•½λ¬Ό μ²λ°© μ¶”μ² λ° μƒνΈμ‘μ© κ²€μ‚¬
- **μ§„λ£ μ”μ•½μ„**: ν™μμ μ „μ²΄ μ§„λ£ μ΄λ ¥ μ”μ•½
- **μλ£μ§„ μΈκ³„μ„**: κµλ€ μ‹ ν•„μ”ν• ν™μ μƒνƒ μΈκ³„ λ¬Έμ„

### π§  AI λ¶„μ„ κΈ°λ¥

- **μ¦μƒ λ¶„μ„**: ν™μ μ¦μƒμ„ λ¶„μ„ν•μ—¬ κ°€λ¥ν• μ§„λ‹¨ μ μ‹
- **κ³Όκ±° μ§„λ£ ν¨ν„΄ λ¶„μ„**: ν™μμ κ³Όκ±° μ§„λ£ μ΄λ ¥ κΈ°λ° μμΈ΅
- **μ‘κΈ‰λ„ ν‰κ°€**: ν™μ μƒνƒμ μ‘κΈ‰λ„ μλ™ ν‰κ°€

### MCP(Model Context Protocol) μ§€μ›

μ΄ μ—μ΄μ „νΈλ” MCPλ¥Ό ν†µν•΄ λ‹¤μκ³Ό κ°™μ€ μ™Έλ¶€ μλ£ μ‹μ¤ν…κ³Ό μ—°λ™ν•  μ μμµλ‹λ‹¤:

#### μ‹¤μ  κµ¬ν„λ MCP μ„λ²„λ“¤

- π”¬ **`pubmed`**: PubMed μν•™ λ…Όλ¬Έ κ²€μƒ‰ μ„λ²„ (ν¬νΈ 8080)
- π’Ύ **`memory`**: ν™μ λ€ν™” κΈ°λ΅ λ©”λ¨λ¦¬ μ„λ²„ (ν¬νΈ 8081)
- π“ **`file_system`**: μλ£ λ¬Έμ„ νμΌ μ‹μ¤ν… μ„λ²„ (ν¬νΈ 8082)

#### A2A-MCP μ—°λ™ API

1. **MCP μ—”λ“ν¬μΈνΈ λ©λ΅ μ΅°ν**

```json
{
  "jsonrpc": "2.0",
  "method": "mcp/list_endpoints",
  "params": {},
  "id": 1
}
```

2. **MCP μ—°κ²° ν…μ¤νΈ**

```json
{
  "jsonrpc": "2.0",
  "method": "mcp/connect",
  "params": {
    "endpoint": "pubmed"
  },
  "id": 2
}
```

3. **PubMed λ…Όλ¬Έ κ²€μƒ‰**

```json
{
  "jsonrpc": "2.0",
  "method": "mcp/search_pubmed",
  "params": {
    "query": "diabetes mellitus treatment",
    "max_results": 5
  },
  "id": 3
}
```

4. **ν™μ λ€ν™” κΈ°λ΅ μ €μ¥**

```json
{
  "jsonrpc": "2.0",
  "method": "mcp/save_memory",
  "params": {
    "session_id": "session_123",
    "content": "ν™μκ°€ λ‹Ήλ‡¨λ³‘ μ¦μƒμ— λ€ν•΄ λ¬Έμν–μµλ‹λ‹¤.",
    "entry_type": "conversation",
    "patient_id": "P001"
  },
  "id": 4
}
```

## κΈ°μ΅΄ LangGraph μ—μ΄μ „νΈμ™€μ ν‘μ—…

### ν‘μ—… μ‹λ‚λ¦¬μ¤

1. **μΆ…ν•© μ§„λ£ μƒλ‹΄**: ν™μ λ°μ΄ν„° + μλ£ λ¬Έν— κ²€μƒ‰
2. **μ²λ°© μµμ ν™”**: ν™μ μ΄λ ¥ + μµμ‹  κ°€μ΄λ“λΌμΈ
3. **μ§„λ‹¨ μ§€μ›**: μ μ‚¬ μ‚¬λ΅€ + μλ£ μ§€μ‹ ν†µν•©

## κΈ°μ  μ¤νƒ

- **LangChain/LangGraph**: μ—μ΄μ „νΈ ν”„λ μ„μ›ν¬
- **ChromaDB**: λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤
- **OpenAI**: LLM λ° μ„λ² λ”©
- **Pydantic**: λ°μ΄ν„° λ¨λΈ κ²€μ¦
- **A2A Protocol**: μ—μ΄μ „νΈ κ°„ ν†µμ‹ 

## μ„¤μΉ λ° μ‹¤ν–‰

1. ν™κ²½ μ„¤μ •:

   ```bash
   cd hi_medei/samples/python/agents/medical_agent
   echo "OPENAI_API_KEY=your_api_key_here" > .env
   ```

2. μ—μ΄μ „νΈ μ‹¤ν–‰:

   ```bash
   uv run . --port 10001
   ```

3. ν΄λΌμ΄μ–ΈνΈ μ—°κ²°:

   ```bash
   cd ../../../hosts/cli
   uv run .
   ```

4. **MCP μ„λ²„λ“¤ μ‹μ‘**:

   ```bash
   # ν„°λ―Έλ„ 1μ—μ„ MCP μ„λ²„λ“¤ μ‹μ‘
   cd hi_medei/samples/python/agents/medical_agent
   python start_mcp_servers.py
   ```

5. **A2A μ„λ²„ μ‹μ‘**:

   ```bash
   # ν„°λ―Έλ„ 2μ—μ„ A2A μ„λ²„ μ‹μ‘
   cd hi_medei/samples/python/agents/medical_agent
   python __main__.py --port 10001
   ```

6. **ν†µν•© ν…μ¤νΈ μ‹¤ν–‰**:
   ```bash
   # ν„°λ―Έλ„ 3μ—μ„ ν…μ¤νΈ μ‹¤ν–‰
   cd hi_medei/samples/python/agents/medical_agent
   python test_mcp_integration.py
   ```

## λ°μ΄ν„° μ†μ¤

- `../../../../data/`: ν™μ λ°μ΄ν„° (λ‚΄κ³Όν™μ, μ™Έκ³Όν™μ, λ‹ΉμΌμ§„λ£ν™μ, μ•½μ²λ°©)
- `../../../../VectorStore2/`: λ²΅ν„° μ„λ² λ”© λ°μ΄ν„°

## μ ν•μ‚¬ν•­

- ν„μ¬λ” ν…μ¤νΈ κΈ°λ° μ…μ¶λ ¥λ§ μ§€μ›
- MCP μ„λ²„κ°€ μ‹¤ν–‰λμ§€ μ•μ€ κ²½μ° μ‹λ®¬λ μ΄μ… μ‘λ‹µ μ κ³µ
- μ‹¤μ  μλ£ ν™κ²½μ—μ„λ” HIPAA λ“± μλ£ μ •λ³΄ λ³΄νΈ κ·μ • μ¤€μ ν•„μ”
- λ°λ¨μ© λ°μ΄ν„° μ‚¬μ© (μ‹¤μ  ν™μ λ°μ΄ν„° μ•„λ‹)

### API μ—”λ“ν¬μΈνΈ

#### A2A ν‘μ¤€ μ—”λ“ν¬μΈνΈ

- `POST /`: JSON-RPC μ”μ²­ μ²λ¦¬
- `POST /stream`: μ¤νΈλ¦¬λ° μ”μ²­ μ²λ¦¬
- `GET /health`: ν—¬μ¤μ²΄ν¬
- `GET /agent-card`: μ—μ΄μ „νΈ μΉ΄λ“ μ •λ³΄
- `GET /.well-known/agent.json`: A2A ν‘μ¤€ μ—μ΄μ „νΈ μΉ΄λ“

#### MCP μ—°λ™ μ—”λ“ν¬μΈνΈ

- `POST /` + `mcp/list_endpoints`: MCP μ—”λ“ν¬μΈνΈ λ©λ΅ μ΅°ν
- `POST /` + `mcp/connect`: MCP μ—°κ²° ν…μ¤νΈ

### μ‚¬μ© μμ‹

#### MCPλ¥Ό ν†µν• μ™Έλ¶€ μ‹μ¤ν… μ΅°ν

```bash
curl -X POST http://localhost:10001 \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "mcp/connect",
    "params": {
      "endpoint": "hospital_db",
      "query": "κΉ€μ² μ ν™μ μ •λ³΄ μ΅°ν"
    },
    "id": 1
  }'
```

### μ•„ν‚¤ν…μ²

```
[A2A ν΄λΌμ΄μ–ΈνΈ]
    β†“ (JSON-RPC over HTTP)
[Patient Data Manager Agent (A2A μ„λ²„)]
    β†“ (MCP JSON-RPC)
[μ™Έλ¶€ μλ£ μ‹μ¤ν…λ“¤ (MCP μ„λ²„λ“¤)]
    - λ³‘μ› DB
    - μλ£ κΈ°λ΅ μ‹μ¤ν…
    - μ•½λ¬Ό DB
    - κ²€μ‚¬ κ²°κ³Ό μ‹μ¤ν…
    - μμƒμν•™ μ‹μ¤ν…
```

μ΄ κµ¬μ΅°μ—μ„:

- **A2A**: μ—μ΄μ „νΈ κ°„ ν‘μ—…κ³Ό νƒμ¤ν¬ κ΄€λ¦¬
- **MCP**: μ™Έλ¶€ λ„κµ¬μ™€ λ°μ΄ν„° μ†μ¤ μ—°κ²°
